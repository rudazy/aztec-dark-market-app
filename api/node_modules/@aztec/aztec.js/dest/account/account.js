import { Fr } from '@aztec/foundation/fields';
import { computeAuthWitMessageHash } from '../utils/authwit.js';
/**
 * An account implementation that uses authwits as an authentication mechanism
 * and can assemble transaction execution requests for an entrypoint.
 */ export class BaseAccount {
    account;
    constructor(account){
        this.account = account;
    }
    createTxExecutionRequest(exec, gasSettings, options) {
        return this.account.createTxExecutionRequest(exec, gasSettings, options);
    }
    getChainId() {
        return this.account.getChainId();
    }
    getVersion() {
        return this.account.getVersion();
    }
    /** Returns the complete address of the account that implements this wallet. */ getCompleteAddress() {
        return this.account.getCompleteAddress();
    }
    /** Returns the address of the account that implements this wallet. */ getAddress() {
        return this.getCompleteAddress().address;
    }
    /**
   * Computes an authentication witness from either a message hash or an intent.
   *
   * If a message hash is provided, it will create a witness for the hash directly.
   * Otherwise, it will compute the message hash using the intent, along with the
   * chain id and the version values provided by the wallet.
   *
   * @param messageHashOrIntent - The message hash of the intent to approve
   * @returns The authentication witness
   */ async createAuthWit(messageHashOrIntent) {
        let messageHash;
        if (Buffer.isBuffer(messageHashOrIntent)) {
            messageHash = Fr.fromBuffer(messageHashOrIntent);
        } else if (messageHashOrIntent instanceof Fr) {
            messageHash = messageHashOrIntent;
        } else {
            messageHash = await this.getMessageHash(messageHashOrIntent);
        }
        return this.account.createAuthWit(messageHash);
    }
    /**
   * Returns the message hash for the given intent
   *
   * @param intent - A tuple of (consumer and inner hash) or (caller and action)
   * @returns The message hash
   */ getMessageHash(intent) {
        const chainId = this.getChainId();
        const version = this.getVersion();
        return computeAuthWitMessageHash(intent, {
            chainId,
            version
        });
    }
}
